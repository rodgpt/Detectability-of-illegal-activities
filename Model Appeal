
library(jagsUI)
library(XLConnect) #### THIS REQUIERES JAVA
library(coda)
library(mcmcplots)
library(tidyverse)
library(rethinking)
library(Metrics)
library(caret)
library(performanceEstimation)
library(dplyr)
library(ggplot2)
library(MCMCvis)
library(gam)
library(beepr)
library(performance)
library(coda)
library(rjags)
library(plotly)

Binomial_dataset    <- read.csv("~/Dropbox/Chile Dataset analysis/Data and code/Data/Binomial_dataset.csv")   


modC <- "model {
for (i in 1:N) { 
        n.binomial[i]         ~  dbern(P[i])
        
        P[i]                  <- prob[i] * SimVio[i] + 0.00001     ## hack required for Rjags -- otherwise 'incompatible'-error 
        
        SimVio[i]             ~  dbern(p[i])

        logit(prob[i])        <- g0    
       
        logit(p[i])           <- g3    
  }
  
  #Priors

  #Intercepts
  g0  ~ dunif(-2.2, -1)  
  g3  ~ dunif(-2.2, -1)  
  
 
} #end model
"
filename.use <- 'jags0.txt'
writeLines(modC, filename.use)  
filename.save <- paste(modC, 'txt', sep = '.') 

  
basis.dat <- 
  list( N            = dim(Binomial_dataset)[1], 
        n.binomial   = Binomial_dataset$Binomial.Response)


## PARAMETERS
pms <- c('g0',  'g3') 


# FIT MODEL
modC <- jags(data = basis.dat,
              parameters.to.save = pms, 
              model.file = "Jags0.txt",
              parallel   = T,
              n.cores    = 3,   
              n.chains   = 3,       
              n.adapt    = 100,   
              n.iter     = 3000,  
              n.burnin   = 500,   
              n.thin     = 1,
              set.seed(150))

mod.use <- modC

hist(mod.use$summary[,8], main="Rhat values", breaks=10000)
plot(mod.use)


